{
    "collab_server" : "",
    "contents" : "Implementing Neil's version of the ERA yeild-curve methods\n========================================================\nThis implements the ERA Excel-based yield curve methods from pages XX to XX of the Draft Decision.  The first step is simply to install the package itself.  Note that, sometimes, due to your own computer security settings, Windows will not allow R to move the package to your R-library.  In that case, rather than running the code below, open up the zip file, copy the folder called \"drpr\" and paste it manually into your library where all of your other R-packages reside\n\n```{r}\n\n#install.packages(\"drpr_0.985.zip\", type=\"binary\", repos=NULL)\n\n```\n\nOnce the package is installed, it is simply a matter of running the code below.  Note that you will need to have the packages and \"minpack.lm\" \"nnls\" installed as well.  If you do not have these packages installed, then install them first before running the library command below.\n\n```{r}\nlibrary(drpr)\n#first read in the relevant dataset.  Note that the data file must consist of at least 3 columns: Maturity, Amount.issued, and Yield (and they must have these names exactly).  Note also that yields must be semi-annual yields. Note that Maturity needs to be the number of years to maturity, not a date.\n# Mydata <- read.csv(nameoffile.csv)   - example of csv file\n\n\n\n#example dataset; copy and paste this code below, with your own \"mydata\" name, in order to get the code to do its thing.  Run the example dataset and compare with the vignette to make sure the outputs are all correct.\n#Jan15m <- Jan15[order(Jan15$Maturity),][-1,] - note this is only required in the example set to remove an outlier and obtain result in vignette\n#First, the Gaussian Normal\n#fit0 <- gswt1(data=Jan15m)\n#print(fit0)\n#Next the Nelson Siegel\n#fit1 <- fitnelsonsiegel(Jan15m)\n#print(fit1)\n#third the nelson-Siegel-Svennson\n#note - ERA says use the number from last time for lambda1start and lambda2start, we have no last time (this is the first time) so use values from Diebold & Ruderbash paper in refs Fig 4.1 p 107\n#fit2 <- fitnelsonsiegelsvensson(Jan15m, lambda1start=1/lambdastart(2.5),\n#lambda2start=1/lambdastart(5))\n#print(fit2)\n#finally, calculate the DRP by subtacting the BBSW from the yield.  The DRP comes at the end and is called \"10 year DRP(intercept)\"\n# note that R does not automatically pick up the five-year BBSW; you need to put that figure in manually to the code below.\n#drp(fit0, fit1, fit2, avspotratesa=2.9546)\n#this just provides a plot of the three different yield curves and the individual bond yields\n#drpplot(fit0, fit1, fit2)\n\n#note that you can also do:\n#summary(fit0)\n#summary(fit1)\n#summary(fit2)\n#this will provide some more diagnostics, but it is not necessary to obtain the DRP.\n\n#Here is my first proper go, calculating via the ERA approach\nERADRP<-read.csv(\"ERA_DRP_calc1.csv\")\nhead(ERADRP)\nstr(ERADRP)\nfit0 <- gswt1(data=ERADRP)\nprint(fit0)\nsummary(fit0)\nfit1 <- fitnelsonsiegel(ERADRP)\nsummary(fit1)\nfit2 <- fitnelsonsiegelsvensson(ERADRP, lambda1start=1/lambdastart(2.5),\nlambda2start=1/lambdastart(5))\nsummary(fit2)\n#note - if you get a singular matrix when you try fit2, it may be outliers, thus you do the try function, and then fit2a.  This has the effect of knocking out a few long-dated bonds, which are causing the singularoty errors\noptions(show.error.messages = TRUE)\nfit2 <- try(fitnelsonsiegelsvensson(ERADRP, lambda1start=1/lambdastart(2.5),\nlambda2start=1/lambdastart(5)))\nfit2\nfit2a <- fitnelsonsiegelsvensson(ERADRP[ERADRP$Maturity<20 & ERADRP$Yield<10,])\nsummary(fit2a)\n\ndrp(fit0, fit1, fit2a, 2.9623)\n\ncoef(fit0[[2]])\n\nBBSW<-mean(ERADRP$RELBBSW)\ndrp(fit0, fit1, fit2a, avspotratesa=BBSW)\ndrpplot(fit0, fit1, fit2a)\n\nsummary(fit0)\n\n\n drp <- \nfunction(GSmodel10, NSmodel, NSSmodel, avspotratesa){\n  cod10 <- round(  (100*((1+coef(GSmodel10[[2]])/200)^2-1)+\n                    100*((1+predict(NSmodel,newdata=data.frame(Maturity=10))/200)^2-1)+\n                    100*((1+predict(NSSmodel,newdata=data.frame(Maturity=10))/200)^2-1 ))/3,4)\n  avswaprateann <- round(((1+avspotratesa/200)^2-1)*100,4)\n  results <- list(avspotratesa, avswaprateann, cod10, cod10-avswaprateann)\n  names(results) <- c(\"Average swap rate (semi-annual basis)\",\n                      \"Annualized Swap average (annual basis)\",\n                      \"10 year final cost of debt estimate\",\n                      \"10 year DRP\")\n  return(results)\n}\n \n drp(fit0, fit1, fit2a, 2.9623)\n\nsummary(fit0)\nsummary(fit1)\nsummary(fit2)\nsummary(fit2a)\n\n\n\n```\n\n\nThe package will also calculate the DRP based upon a stratified sample of BBB-band bonds, splitting it by the different credit ratings within this band to improve the overall estimate of the DRP.  The code below will implement this vertsion of the model.  Note that I have just included the example dataset, but the user can copy and paste with their own data as above.  Note also that you need to input the 5-year BBSW manually.  Note finally that, since the plots include curves for the different credit ratings within the BBB-band, there is one plot per model, rather than all three models on the one plot\n\n```{r}\n#fit3 <- gswt1adjust(data=Jan15m)\n#print(fit3)\n#plot(fit3)\n#fit4 <- fitnelsonsiegeladjust(Jan15m)\n#print(fit4)\n#plot(fit4)\n#fit5 <- fitnelsonsiegelsvenssonadjust(Jan15m, lambda1start=1/lambdastart(2.5),\n#lambda2start=1/lambdastart(5))\n#print(fit5)\n#plot(fit5)\n#drpadjust(fit3,fit4,fit5, avspotratesa=2.9546)\n\nfit3 <- gswt1adjust(data=ERADRP)\nprint(fit3)\nplot(fit3)\nfit4 <- fitnelsonsiegeladjust(ERADRP)\nprint(fit4)\nplot(fit4)\nfit5 <- fitnelsonsiegelsvenssonadjust(ERADRP, lambda1start=1/lambdastart(2.5),\nlambda2start=1/lambdastart(5))\nprint(fit5)\nplot(fit5)\ndrpadjust(fit3,fit4,fit5, avspotratesa=BBSW)\n\n\n\n```\n\n\n\n\n\n\n",
    "created" : 1454663056205.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2052640286",
    "id" : "393BB815",
    "lastKnownWriteTime" : 1454927368,
    "last_content_update" : 0,
    "path" : "~/Documents/DRP/drpr/vignettes/Neil version of ERA curve-fitting techniques.Rmd",
    "project_path" : "vignettes/Neil version of ERA curve-fitting techniques.Rmd",
    "properties" : {
    },
    "relative_order" : 38,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}