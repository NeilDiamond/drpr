{
    "collab_server" : "",
    "contents" : "Implementing Neil's version of the ERA yeild-curve methods\n========================================================\nThis implements the ERA Excel-based yield curve methods from pages XX to XX of the Draft Decision.  The first step is simply to install the package itself.  Note that, sometimes, due to your own computer security settings, Windows will not allow R to move the package to your R-library.  In that case, rather than running the code below, open up the zip file, copy the folder called \"drpr\" and paste it manually into your library where all of your other R-packages reside\n\n```{r}\n\ninstall.packages(\"drpr_0.985.zip\", type=\"binary\", repos=NULL)\n\n```\n\nOnce the package is installed, it is simply a matter of running the code below.  Note that you will need to have the packages and \"minpack.lm\" \"nnls\" installed as well.  If you do not have these packages installed, then install them first before running the library command below.\n\n```{r}\nlibrary(drpr)\n#first read in the relevant dataset.  Note that the data file must consist of at least 3 columns: Maturity, Amount.issued, and Yield (and they must have these names exactly).  Note also that yields must be semi-annual yields\n# Mydata <- read.csv(nameoffile.csv)   - example of csv file\n# once you have read in the dataset, you need to order it, as with the example dataset below, so that the package will run properly.\n#mydatam <- mydata[order(mydata$Maturity),][-1,] - NEIL - WHAT'S THE MEANING OF THE[-1]?\n\n\n#example dataset; copy and paste this code below, with your own \"mydata\" name, in order to get the code to do its thing.  Run the example dataset and compare with the vignette to make sure the outputs are all correct.\nJan15m <- Jan15[order(Jan15$Maturity),][-1,] \n#First, the Gaussian Normal\nfit0 <- gswt1(data=Jan15m)\nprint(fit0)\n#Next the Nelson Siegel\nfit1 <- fitnelsonsiegel(Jan15m)\nstr(fit1)\nvcov(fit1[[1]])\ngetS3method(\"vcov\",\"nls\")\nconfint(fit1[[1]])\nvcov.NelsonSiegel <- function(obj) { ?vcov.nls(obj)}\nrm(vcov.NelsonSiegel)\nlibrary(car)\n\nclass(fit1)\ndm10 <- deltaMethod(fit1,\npaste0(\"exp(delta1) + (exp(delta2)-exp(delta1)) * (1-exp(-10*(exp(gamma)))) /\n                      (10*(exp(gamma))) +\n                      delta3 * ((1-exp(-10*(exp(gamma)))) /\n                                  (10*(exp(gamma)))-\n                                  exp(-10*(exp(gamma))))\")) \n\n\nprops1 <- table(Data1$RTG_SP)[c(1,3)]/sum(table(Data1$RTG_SP)[1:3])\n\ndm10D1 <- deltaMethod(fitdummy1,\npaste0(\"beta1+\",props1[1],\"*beta4+\",props1[2],\"*beta5+beta2*(1-exp(-10*exp(beta0)))/(10*exp(beta0))+beta3*((1-exp(-10*exp(beta0)))/(10*exp(beta0))-exp(-10*exp(beta0)))\")) \n\n\n\nprint(fit1)\n#third the nelson-Siegel-Svennson\nfit2 <- fitnelsonsiegelsvensson(Jan15m, lambda1start=1/lambdastart(2.5),\nlambda2start=1/lambdastart(5))\nprint(fit2)\n#finally, calculate the DRP by subtacting the BBSW from the yield.  The DRP comes at the end and is called \"10 year DRP(intercept)\"\n# note that R does not automatically pick up the five-year BBSW; you need to put that figure in manually to the code below.\ndrp(fit0, fit1, fit2, avspotratesa=2.9546)\n#this just provides a plot of the three different yield curves and the individual bond yields\ndrpplot(fit0, fit1, fit2)\n\n#note that you can also do:\nsummary(fit0)\nsummary(fit1)\nsummary(fit2)\n#this will provide some more diagnostics, but it is not necessary to obtain the DRP.\n\n\n\n```\n\n\nThe package will also calculate the DRP based upon a stratified sample of BBB-band bonds, splitting it by the different credit ratings within this band to improve the overall estimate of the DRP.  The code below will implement this vertsion of the model.  Note that I have just included the example dataset, but the user can copy and paste with their own data as above.  Note also that you need to input the 5-year BBSW manually.  Note finally that, since the plots include curves for the different credit ratings within the BBB-band, there is one plot per model, rather than all three models on the one plot\n\n```{r}\nfit3 <- gswt1adjust(data=Jan15m)\nprint(fit3)\nplot(fit3)\nfit4 <- fitnelsonsiegeladjust(Jan15m)\nprint(fit4)\nplot(fit4)\nfit5 <- fitnelsonsiegelsvenssonadjust(Jan15m, lambda1start=1/lambdastart(2.5),\nlambda2start=1/lambdastart(5))\nprint(fit5)\nplot(fit5)\ndrpadjust(fit3,fit4,fit5, avspotratesa=2.9546)\n\n```\n\n\n\n\n\n\n",
    "created" : 1454561962591.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2081617260",
    "id" : "639FDFB4",
    "lastKnownWriteTime" : 1454570696,
    "last_content_update" : 0,
    "path" : "~/Documents/DRP/drpr/Neil version of ERA curve-fitting techniques.Rmd",
    "project_path" : "Neil version of ERA curve-fitting techniques.Rmd",
    "properties" : {
    },
    "relative_order" : 37,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}